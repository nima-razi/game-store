<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add game modal</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
</head>
<body>
    <div id="addVideoGameModal" class="modal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5">Add videogame</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="videoGameForm" class="needs-validation was-validated" novalidate>
                        <!-- NAME & PICTURE -->
                        <div class="row g-3 mb-3">
                            <div class="col-lg-6">
                                <label class="form-label" for="productName" required>Name*</label>
                                <input type="text" class="form-control" placeholder="Name of product" aria-label="Name" id="productName" required>
                            </div>
                            <div class="col-lg-6">
                                <label for="imageFiles" class="form-label">Images*</label>
                                <input class="form-control" type="file" id="imageFiles" multiple accept=".jpeg,.jpg,.png">
                            </div>
                        </div>
                        <!-- DEVELOPER & PUBLISHER -->
                        <div class="row g-3 mb-3">
                            <div class="col-lg-6">
                                <label class="form-label" for="developer" required>Developer*</label>
                                <input type="text" class="form-control" placeholder="Game developer" aria-label="Developer" id="developer" required>
                            </div>
                            <div class="col-lg-6">
                                <label for="publisher" class="form-label">Publisher*</label>
                                <input type="text" class="form-control" placeholder="Game publisher" id="publisher" required>
                            </div>
                        </div>
                        <!-- PLATFORM & GENRE -->
                        <div class="row g-3 mb-3">
                            <div class="col-lg-6">
                                <label class="form-label" for="platform" required>Platform*</label>
                                <select class="form-control" name="" id="platform">
                                    <option selected>Choose platform</option>
                                    <option value="PC">PC</option>
                                    <option value="PlayStation">PlayStation</option>
                                    <option value="PlayStation Portable">PlayStation Portable</option>
                                    <option value="PlayStation 2">PlayStation 2</option>
                                    <option value="PlayStation 3">PlayStation 3</option>
                                    <option value="PlayStation 4">PlayStation 4</option>
                                    <option value="PlayStation 5">PlayStation 5</option>
                                    <option value="Nintendo Switch">Nintendo Switch</option>
                                    <option value="Wii U">Wii U</option>
                                    <option value="Xbox">Xbox</option>
                                    <option value="Xbox 360">Xbox 360</option>
                                    <option value="Xbox One">Xbox One</option>
                                    <option value="Xbox Series X/S">Xbox Series X/S</option>
                                </select>
                            </div>
                            <div class="col-lg-6">
                                <label for="genre" class="form-label">Genre*</label>
                                <select class="form-control" name="" id="genre">
                                    <option selected>Choose genre</option>
                                    <option value="Action-adventure">Action-adventure</option>
                                    <option value="Action role-playing">Action role-playing</option>
                                    <option value="First-person shooter">First-person shooter</option>
                                    <option value="Racing">Racing</option>
                                    <option value="Racing simulation">Racing simulation</option>
                                    <option value="Role-playing game">Role-playing game</option>
                                    <option value="Survival horror">Survival horror</option>
                                </select>
                            </div>
                        </div>
                        <!-- AGE RATING, PRICE & RELEASE YEAR -->
                        <div class="row g-3 mb-3">
                            <div class="col-lg-4">
                                <label for="ageRating" class="form-label">Age rating*</label>
                                <select class="form-control" name="" id="ageRating">
                                    <option selected>Choose age rating</option>
                                    <option value="E">Everyone</option>
                                    <option value="E10+">Everyone 10+</option>
                                    <option value="T">Teen</option>
                                    <option value="M">Mature</option>
                                </select>
                            </div>
                            <div class="col-lg-4">
                                <label for="priceInput" class="form-label">Price*</label>
                                <input min="0" step="0,01" type="number" placeholder="0,00 €" class="form-control" id="priceInput" required>
                            </div>
                            <div class="col-lg-4">
                                <label for="releaseYear" class="form-label">Release year*</label>
                                <input type="number" min="0" placeholder="YYYY" class="form-control" id="releaseYear" required>
                            </div>
                        </div>
                        <!-- URL -->
                        <div class="mb-3">
                            <label class="form-label" for="productUrl">URL to official game page</label>
                            <input type="url" class="form-control" placeholder="https://" id="productUrl"></input>
                        </div>
                        <!-- DESCRIPTION -->
                        <div class="mb-3">
                            <label class="form-label" for="description">Description*</label>
                            <textarea class="form-control" placeholder="" id="description" required></textarea>
                        </div>
                        <!-- BUTTONS -->
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="submit" class="btn btn-primary">Add</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO" crossorigin="anonymous"></script>
    <script>
        const modal = new bootstrap.Modal(document.getElementById('addVideoGameModal'));
        modal.show();

        document.getElementById('videoGameForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            if (!this.checkValidity()) {
                this.classList.add('was-validated');
                return;
            }
            
            const newGame = {
                title: document.getElementById('productName').value,
                developer: document.getElementById('developer').value,
                publisher: document.getElementById('publisher').value,
                rating: document.getElementById('ageRating').value,
                price: document.getElementById('priceInput').value + "€",
                release_year: parseInt(document.getElementById('releaseYear').value),
                description: document.getElementById('description').value,
                image: "assets/images/covers/default.jpg", // Replace with real image logic
                platforms: [document.getElementById('platform').value],
                genre: document.getElementById('genre').value,
                id: Date.now(), // unique ID
                url: document.getElementById('productUrl').value
            };

            const response = await fetch('http://localhost:3000/add-game', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(newGame)
            });

            if (response.ok) {
                alert('Game added successfully!');
                document.getElementById('videoGameForm').reset();
                bootstrap.Modal.getInstance(document.getElementById('addVideoGameModal')).hide();
            } else {
                alert('Failed to add game.');
            }
        });
    </script>
</body>
</html>